---
import { pickBoolean, pickNumber, pickString } from '../lib/props';
import { t } from '../lib/i18n';

export interface Props {
  src?: string;
  url?: string;
  image?: string;
  alt?: string;
  caption?: string;
  title?: string;
  width?: number;
  height?: number;
  href?: string;
  link?: string;
  target?: string;
  class?: string;
  figureClass?: string;
  nozoom?: boolean;
}

const props = Astro.props as Record<string, unknown>;
const src = pickString(props, ['src', 'url', 'image']);
const alt = pickString(props, ['alt', 'title', 'caption'], t('components.image_alt'));
const caption = pickString(props, ['caption', 'title']);
const width = pickNumber(props, ['width'], 0);
const height = pickNumber(props, ['height'], 0);
const href = pickString(props, ['href', 'link']);
const target = pickString(props, ['target'], '_blank');
const imgClass = pickString(props, ['class']);
const figureClass = pickString(props, ['figureClass']);
const nozoom = pickBoolean(props, ['nozoom'], false);

// Build image classes matching upstream: my-0 rounded-md [nozoom] [custom class]
const imageClasses = [
  'my-0 rounded-md',
  nozoom && 'nozoom',
  imgClass
].filter(Boolean).join(' ');
---

<figure class={figureClass || undefined}>
  {href ? (
    <a href={href} target={target} class="inline-block">
      <img
        class={imageClasses}
        src={src}
        alt={alt}
        width={width || undefined}
        height={height || undefined}
        loading="lazy"
        decoding="async"
        fetchpriority="auto"
        data-zoom-src={!nozoom ? src : undefined}
      />
    </a>
  ) : (
    <img
      class={imageClasses}
      src={src}
      alt={alt}
      width={width || undefined}
      height={height || undefined}
      loading="lazy"
      decoding="async"
      fetchpriority="auto"
      data-zoom-src={!nozoom ? src : undefined}
    />
  )}
  {caption && <figcaption set:html={caption} />}
</figure>
