---
import { t } from '../../lib/i18n';
import BlowfishIcon from '../BlowfishIcon.astro';
import type { BlowfishHomepageConfig, BlowfishRecentArticle } from '../../types/homepage';
import BlowfishHomeRecent from './BlowfishHomeRecent.astro';

export interface Props {
  config: BlowfishHomepageConfig;
  articles?: BlowfishRecentArticle[];
  contentHtml?: string;
}

const { config, articles = [], contentHtml = '' } = Astro.props;
const avatar = config.homepageImage || config.image;
const getIconName = (label: string, icon?: string) => icon || label.toLowerCase().replaceAll(' ', '-');
---

<article
  class:list={[
    !config.showRecent && 'h-full',
    'flex flex-col items-center justify-center text-center',
  ]}
>
  <header class="relative mb-3 flex flex-col items-center px-1 py-1">
    {avatar && <img class="mb-2 h-36 w-36 rounded-full object-cover" src={avatar} alt={config.imageAlt || config.title || t('components.author_image_alt')} />}
    <h1 class="text-4xl font-extrabold">{config.title || t('author.default_name')}</h1>
    {config.subtitle && <h2 class="text-xl text-neutral-500 dark:text-neutral-400">{config.subtitle}</h2>}
    {config.links && config.links.length > 0 && (
      <div class="mt-1 flex flex-wrap text-2xl">
        {config.links.map((link) => (
          <a class="px-1 text-primary-700 hover:text-primary-500 dark:text-primary-300 dark:hover:text-primary-400" href={link.href} target="_blank" rel="noopener noreferrer" aria-label={link.label} title={link.label}>
            <span class="inline-block align-text-bottom">
              <BlowfishIcon name={getIconName(link.label, link.icon)} />
            </span>
            <span class="sr-only">{link.label}</span>
          </a>
        ))}
      </div>
    )}
  </header>
  <section class="prose w-full dark:prose-invert">
    {contentHtml ? <div set:html={contentHtml} /> : config.description ? <p>{config.description}</p> : <slot />}
  </section>
</article>

{config.showRecent && (
  <BlowfishHomeRecent
    articles={articles}
    limit={config.recentLimit || 4}
    cardView={Boolean(config.cardView)}
    showMoreLink={config.showMoreLink}
    heading={t('shortcode.recent_articles')}
  />
)}
