---
import { t } from '../../lib/i18n';
import BlowfishIcon from '../BlowfishIcon.astro';
import BlowfishHomeRecent from './BlowfishHomeRecent.astro';
import type { BlowfishHomepageConfig, BlowfishRecentArticle } from '../../types/homepage';

export interface Props {
  config: BlowfishHomepageConfig;
  articles?: BlowfishRecentArticle[];
  contentHtml?: string;
}

const { config, articles = [], contentHtml = '' } = Astro.props;
const heroImage = config.homepageImage || config.image || '';
const avatar = config.image || config.homepageImage;
const disableFilter = config.disableHeroImageFilter ?? false;

// Classes that change based on filter mode (matching upstream hero.html)
const h1Class = disableFilter
  ? 'mb-2 text-4xl font-extrabold text-neutral-800 dark:text-neutral-200'
  : 'mb-2 text-4xl font-extrabold text-neutral-200';
const h2Class = disableFilter
  ? 'mb-0 mt-0 text-xl text-neutral-800 dark:text-neutral-300'
  : 'mb-0 mt-0 text-xl text-neutral-300';
const linkClass = disableFilter
  ? 'px-1 text-primary-800 hover:text-primary-400 dark:text-primary-200'
  : 'px-1 text-primary-300 hover:text-primary-400';
const proseClass = disableFilter
  ? 'prose dark:prose-invert w-full'
  : 'prose prose-invert w-full';
const getIconName = (label: string, icon?: string) => icon || label.toLowerCase().replaceAll(' ', '-');
---

<article class="max-w-full prose dark:prose-invert">
  <div class="relative">
    <div class="absolute inset-x-0 bottom-0 h-1/2"></div>
    <div class="mx-auto max-w-7xl p-0">
      <div class="relative overflow-hidden rounded-2xl shadow-xl sm:overflow-hidden">
        <div class="absolute inset-0">
          {heroImage && <img src={heroImage} alt="" class="mt-0 mr-0 mb-0 ml-0 h-full w-full object-cover nozoom" />}
          {disableFilter ? (
            <div class="absolute inset-0 from-primary-500 to-secondary-600 dark:from-primary-600 dark:to-secondary-800 mix-blend-multiply"></div>
          ) : (
            <div class="absolute inset-0 bg-gradient-to-r from-primary-500 to-secondary-600 dark:from-primary-600 dark:to-secondary-800 mix-blend-multiply"></div>
          )}
        </div>
        <div class="relative flex flex-col items-center justify-center px-4 py-16 text-center sm:px-6 sm:py-24 lg:px-8 lg:py-32">
          {avatar && (
            <img
              class="mb-2 h-36 w-36 rounded-full"
              width="144"
              height="144"
              src={avatar}
              alt={config.imageAlt || config.title || t('components.author_image_alt')}
              data-zoom-src={avatar}
            />
          )}
          <h1 class={h1Class}>{config.title || t('author.default_name')}</h1>
          {config.subtitle && <h2 class={h2Class}>{config.subtitle}</h2>}
          {config.links && config.links.length > 0 && (
            <div class="mt-3 mb-10 flex flex-wrap text-2xl">
              {config.links.map((link) => (
                <a class={linkClass} href={link.href} target="_blank" rel="me noopener noreferrer" aria-label={link.label} title={link.label}>
                  <span class="inline-block align-text-bottom">
                    <BlowfishIcon name={getIconName(link.label, link.icon)} />
                  </span>
                  <span class="sr-only">{link.label}</span>
                </a>
              ))}
            </div>
          )}
          <section class={proseClass}>
            {contentHtml ? <div set:html={contentHtml} /> : config.description ? <p>{config.description}</p> : <slot />}
          </section>
        </div>
      </div>
    </div>
  </div>
</article>

{config.showRecent && (
  <BlowfishHomeRecent
    articles={articles}
    limit={config.recentLimit || 4}
    cardView={Boolean(config.cardView)}
    showMoreLink={config.showMoreLink}
    heading={t('shortcode.recent_articles')}
  />
)}
