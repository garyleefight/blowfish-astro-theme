---
import { pickArray, pickNumber, pickString } from '../lib/props';

interface GalleryItem {
  src?: string;
  image?: string;
  url?: string;
  alt?: string;
  title?: string;
  caption?: string;
  text?: string;
}

export interface Props {
  images?: GalleryItem[];
  items?: GalleryItem[];
  columns?: 2 | 3 | 4;
  cols?: 2 | 3 | 4;
}

const props = Astro.props as Record<string, unknown>;
const images = pickArray<GalleryItem>(props, ['images', 'items']);
const columns = pickNumber(props, ['columns', 'cols'], 3);
const normalizedColumns = columns === 2 || columns === 4 ? columns : 3;
const normalizedImages = images.map((image) => {
  const record = image as Record<string, unknown>;
  return {
    src: pickString(record, ['src', 'image', 'url']),
    alt: pickString(record, ['alt', 'title', 'caption'], 'image'),
    caption: pickString(record, ['caption', 'text', 'title'])
  };
});
---

<section class="bf-gallery" style={`--bf-gallery-cols: ${normalizedColumns};`}>
  {normalizedImages.map((image) => (
    <figure class="bf-card">
      <img src={image.src} alt={image.alt} loading="lazy" />
      {image.caption && <figcaption>{image.caption}</figcaption>}
    </figure>
  ))}
</section>

<style>
  .bf-gallery {
    display: grid;
    gap: 0.8rem;
    grid-template-columns: repeat(var(--bf-gallery-cols), minmax(0, 1fr));
  }

  .bf-gallery figure {
    margin: 0;
    overflow: hidden;
  }

  .bf-gallery img {
    width: 100%;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    display: block;
  }

  .bf-gallery figcaption {
    padding: 0.4rem 0.7rem 0.6rem;
    font-size: 0.8rem;
    color: var(--bf-muted);
  }

  @media (max-width: 920px) {
    .bf-gallery {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (max-width: 560px) {
    .bf-gallery {
      grid-template-columns: 1fr;
    }
  }
</style>
