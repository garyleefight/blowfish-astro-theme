---
import { pickArray, pickString } from '../lib/props';
import { t } from '../lib/i18n';

interface GalleryItem {
  src?: string;
  image?: string;
  url?: string;
  alt?: string;
  title?: string;
  caption?: string;
  text?: string;
  class?: string;
  gridClass?: string;
}

export interface Props {
  images?: GalleryItem[];
  items?: GalleryItem[];
  id?: string;
}

const props = Astro.props as Record<string, unknown>;
const images = pickArray<GalleryItem>(props, ['images', 'items']);
const galleryId = pickString(props, ['id'], `gallery-${Math.random().toString(36).slice(2, 9)}`);

const normalizedImages = images.map((image) => {
  const record = image as Record<string, unknown>;
  return {
    src: pickString(record, ['src', 'image', 'url']),
    alt: pickString(record, ['alt', 'title', 'caption'], t('components.image_alt')),
    caption: pickString(record, ['caption', 'text', 'title']),
    class: pickString(record, ['class', 'gridClass']),
  };
});

// Check if we have slot content (for raw HTML gallery like upstream)
const hasSlot = Astro.slots.has('default');
---

<div class="width-patch"></div>
{hasSlot ? (
  <div id={galleryId} class="gallery">
    <slot />
  </div>
) : (
  <div id={galleryId} class="gallery">
    {normalizedImages.map((image) => (
      <figure class={image.class || undefined}>
        <img
          src={image.src}
          alt={image.alt}
          loading="lazy"
          class="mt-0 mb-0"
          data-zoom-src={image.src}
        />
        {image.caption && <figcaption>{image.caption}</figcaption>}
      </figure>
    ))}
  </div>
)}
