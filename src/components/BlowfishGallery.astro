---
import { pickArray, pickNumber, pickString } from '../lib/props';
import { t } from '../lib/i18n';

interface GalleryItem {
  src?: string;
  image?: string;
  url?: string;
  alt?: string;
  title?: string;
  caption?: string;
  text?: string;
}

export interface Props {
  images?: GalleryItem[];
  items?: GalleryItem[];
  columns?: 2 | 3 | 4;
  cols?: 2 | 3 | 4;
}

const props = Astro.props as Record<string, unknown>;
const images = pickArray<GalleryItem>(props, ['images', 'items']);
const columns = pickNumber(props, ['columns', 'cols'], 3);
const normalizedColumns = columns === 2 || columns === 4 ? columns : 3;
const normalizedImages = images.map((image) => {
  const record = image as Record<string, unknown>;
  return {
    src: pickString(record, ['src', 'image', 'url']),
    alt: pickString(record, ['alt', 'title', 'caption'], t('components.image_alt')),
    caption: pickString(record, ['caption', 'text', 'title'])
  };
});

const columnsClass =
  normalizedColumns === 2
    ? 'md:grid-cols-2'
    : normalizedColumns === 4
      ? 'md:grid-cols-4'
      : 'md:grid-cols-3';
---

<div class:list={['gallery grid grid-cols-1 gap-3 sm:grid-cols-2', columnsClass]}>
  {normalizedImages.map((image) => (
    <figure class="m-0 overflow-hidden rounded-md border border-neutral-200 shadow-sm dark:border-neutral-700">
      <img src={image.src} alt={image.alt} loading="lazy" class="mt-0 mb-0 block aspect-[4/3] w-full object-cover" />
      {image.caption && <figcaption class="px-3 py-2 text-sm text-neutral-600 dark:text-neutral-400">{image.caption}</figcaption>}
    </figure>
  ))}
</div>
