---
import BlowfishIcon from '../../BlowfishIcon.astro';
import BlowfishAppearanceToggle from '../BlowfishAppearanceToggle.astro';
import BlowfishA11y from './BlowfishA11y.astro';
import BlowfishTranslations, { type TranslationItem } from './BlowfishTranslations.astro';
import { t } from '../../../lib/i18n';

export interface MenuItem {
  name: string;
  url: string;
  title?: string;
  pre?: string;
  children?: MenuItem[];
}

export interface Props {
  mainMenu?: MenuItem[];
  translations?: TranslationItem[];
  currentLanguage?: string;
  enableA11y?: boolean;
  enableSearch?: boolean;
  enableAppearanceToggle?: boolean;
  showDisableBlurA11y?: boolean;
  showDisableImagesA11y?: boolean;
}

const {
  mainMenu = [],
  translations = [],
  currentLanguage = t('global.language'),
  enableA11y = false,
  enableSearch = false,
  enableAppearanceToggle = false,
  showDisableBlurA11y = true,
  showDisableImagesA11y = true,
} = Astro.props;

const isExternal = (url: string) => url.startsWith('http:') || url.startsWith('https:');
---

<nav class="flex items-center gap-x-5 h-12">
  {mainMenu.map((item) =>
    item.children && item.children.length > 0 ? (
      <div class="nested-menu">
        <div class="cursor-pointer flex items-center">
          <a
            href={item.url || '#'}
            target={isExternal(item.url) ? '_blank' : undefined}
            aria-label={item.name || item.pre}
            class="flex items-center text-base font-medium text-neutral-700 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"
            title={item.title}
          >
            {item.pre && (
              <span class={item.name ? 'mr-1' : undefined}>
                <BlowfishIcon name={item.pre} />
              </span>
            )}
            <span class="text-bg font-bg break-normal" title={item.title}>{item.name}</span>
            <span>
              <BlowfishIcon name="chevron-down" />
            </span>
          </a>
        </div>
        <div class="menuhide">
          <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl bg-neutral/25 dark:bg-neutral-800/25">
            <div class="flex flex-col space-y-3">
              {item.children.map((child) => (
                <a
                  href={child.url}
                  target={isExternal(child.url) ? '_blank' : undefined}
                  aria-label={child.name || child.pre}
                  class="flex items-center text-neutral-700 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"
                >
                  {child.pre && (
                    <span class={child.name ? 'mr-1' : undefined}>
                      <BlowfishIcon name={child.pre} />
                    </span>
                  )}
                  <span class="text-sm font-sm" title={child.title}>{child.name}</span>
                </a>
              ))}
            </div>
          </div>
        </div>
      </div>
    ) : (
      <a
        href={item.url}
        target={isExternal(item.url) ? '_blank' : undefined}
        class="flex items-center text-neutral-700 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"
        aria-label={item.name || item.pre}
        title={item.title}
      >
        {item.pre && (
          <span class={item.name ? 'mr-1' : undefined}>
            <BlowfishIcon name={item.pre} />
          </span>
        )}
        {item.name && <span class="text-base font-medium break-normal">{item.name}</span>}
      </a>
    )
  )}

  <BlowfishTranslations translations={translations} currentLanguage={currentLanguage} />

  {enableA11y && (
    <BlowfishA11y
      prefix="desktop-"
      showDisableBlur={showDisableBlurA11y}
      showDisableImages={showDisableImagesA11y}
    />
  )}

  {enableSearch && (
    <button id="search-button" aria-label={t('search.button_label')} class="text-base text-neutral-700 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400" title={t('search.open_button_title')}>
      <BlowfishIcon name="search" />
    </button>
  )}

  {enableAppearanceToggle && (
    <div class="flex items-center">
      <BlowfishAppearanceToggle id="appearance-switcher" />
    </div>
  )}
</nav>
