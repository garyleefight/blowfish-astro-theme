---
import { pickBoolean, pickString } from '../lib/props';
import { t } from '../lib/i18n';

export interface Props {
  src?: string;
  url?: string;
  video?: string;
  poster?: string;
  title?: string;
  caption?: string;
  controls?: boolean;
  autoplay?: boolean;
  muted?: boolean;
  loop?: boolean;
}

const props = Astro.props as Record<string, unknown>;
const src = pickString(props, ['src', 'url', 'video']);
const poster = pickString(props, ['poster']);
const caption = pickString(props, ['caption', 'title']);
const controls = pickBoolean(props, ['controls'], true);
const autoplay = pickBoolean(props, ['autoplay'], false);
const muted = pickBoolean(props, ['muted'], false);
const loop = pickBoolean(props, ['loop'], false);
---

<figure>
  <video
    class="w-full rounded-md aspect-video object-contain"
    preload="metadata"
    poster={poster || undefined}
    controls={controls}
    autoplay={autoplay}
    muted={muted}
    loop={loop}
    playsinline
  >
    <source src={src} />
    <p>{t('components.video_not_supported')} <a href={src}>{t('components.download_video')}</a>.</p>
  </video>
  {caption && <figcaption>{caption}</figcaption>}
</figure>
